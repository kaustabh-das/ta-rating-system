System.register([],function(e,t){"use strict";return{execute:function(){window.TAManager=class e{static populateTADropdown(){for(;domElements.taSelect.options.length>1;)domElements.taSelect.remove(1);const e=document.getElementById("customTASelect"),t=e?.querySelector(".select-text");t&&(t.textContent="Choose a Technical Assistant",t.classList.remove("selected")),domElements.taSelect.value="",appState.taList.forEach((e,t)=>{const a=document.createElement("option");a.value=e.taId,a.textContent=e.name,domElements.taSelect.appendChild(a)}),this.initializeCustomDropdown()}static initializeCustomDropdown(){const t=document.getElementById("customTASelect");if(!t)return;const a=t.querySelector(".select-trigger"),n=t.querySelector(".select-options"),r=t.querySelector(".select-text"),i=document.getElementById("taSelect");if(!(a&&n&&r&&i))return;n.innerHTML="",appState.taList.forEach(e=>{const t=document.createElement("div");t.className="select-option",t.textContent=e.name,t.dataset.value=e.taId,n.appendChild(t)});const s=a.cloneNode(!0);a.parentNode.replaceChild(s,a);const o=t.querySelector(".select-trigger"),l=t.querySelector(".select-options"),c=t.querySelector(".select-text");o.addEventListener("click",e=>{e.stopPropagation();const t=o.classList.contains("active");document.querySelectorAll(".select-trigger.active").forEach(e=>{e!==o&&(e.classList.remove("active"),e.nextElementSibling.classList.remove("show"))}),t?(o.classList.remove("active"),l.classList.remove("show")):(o.classList.add("active"),l.classList.add("show"))}),l.addEventListener("click",e=>{if(e.target.classList.contains("select-option")&&!e.target.classList.contains("disabled")){const t=e.target.dataset.value,a=e.target.textContent;c&&(c.textContent=a,c.classList.add("selected")),i.value=t,l.querySelectorAll(".select-option").forEach(e=>{e.classList.remove("selected")}),e.target.classList.add("selected"),o.classList.remove("active"),l.classList.remove("show"),UIUtils.hideError(domElements.taSelectError),i.dispatchEvent(new Event("change"))}}),e._outsideClickHandler||(e._outsideClickHandler=e=>{const t=document.getElementById("customTASelect");if(t&&!t.contains(e.target)){const e=t.querySelector(".select-trigger"),a=t.querySelector(".select-options");e&&a&&(e.classList.remove("active"),a.classList.remove("show"))}},document.addEventListener("click",e._outsideClickHandler))}static cleanupDropdownListeners(){e._outsideClickHandler&&(document.removeEventListener("click",e._outsideClickHandler),e._outsideClickHandler=null)}static handleTASelection(){UIUtils.hideError(domElements.taSelectError);const e=domElements.taSelect.value;if(!e)return UIUtils.showError(domElements.taSelectError,"Please select a TA"),!1;const t=domElements.taSelect.options[domElements.taSelect.selectedIndex].textContent;return appState.setSelectedTA(e,t),!0}},window.RatingManager=class e{static createRatingControls(){const t=document.getElementById("ratingControls");t&&t.remove();const a=document.createElement("div");a.id="ratingControls",a.className="rating-controls";const n=appState.existingReviewPeriods.filter(e=>!appState.currentDisplayedPeriod||!(e.startDate===appState.currentDisplayedPeriod.startDate&&e.endDate===appState.currentDisplayedPeriod.endDate)).map(e=>({text:`${e.startDate} - ${e.endDate}`,value:e})),r=n.length>0?"Select a rating period ▼":"No other rating periods available",i=appState.existingReviewPeriods.length<=1,s=UIUtils.createDropdown(n,t=>e.displayRatingForPeriod(t.value),r,i);s.container.style.maxWidth="300px",s.container.style.flexShrink="1";const o=document.createElement("button");o.id="addNewRatingBtn",o.type="button",o.className="compact-btn",o.textContent="+ Rating",o.addEventListener("click",function(){ScreenManager.showDateRangeModal()}),a.appendChild(s.container),a.appendChild(o),domElements.ratingContainer.querySelector(".content");const l=document.getElementById("selectedTAName");l.parentNode.insertBefore(a,l.nextSibling)}static refreshDropdown(){const t=document.querySelector("#ratingControls .dropdown-container");if(!t)return void e.updateDropdownButtonText();const a=appState.existingReviewPeriods.filter(e=>!appState.currentDisplayedPeriod||!(e.startDate===appState.currentDisplayedPeriod.startDate&&e.endDate===appState.currentDisplayedPeriod.endDate)).map(e=>({text:`${e.startDate} - ${e.endDate}`,value:e}));let n;n=appState.currentDisplayedPeriod?`${appState.currentDisplayedPeriod.startDate} - ${appState.currentDisplayedPeriod.endDate} ▼`:a.length>0?"Select a rating period ▼":"No rating periods available";const r=appState.existingReviewPeriods.length<=1,i=UIUtils.createDropdown(a,t=>e.displayRatingForPeriod(t.value),n,r);i.container.style.maxWidth="300px",i.container.style.flexShrink="1",t.parentNode.replaceChild(i.container,t)}static updateDropdownButtonText(){const e=document.querySelector("#ratingControls .dropdown-container button");if(!e||!appState.currentDisplayedPeriod)return;const t=`${appState.currentDisplayedPeriod.startDate} - ${appState.currentDisplayedPeriod.endDate}`;e.textContent=t+" ▼"}static async displayRatingForPeriod(t){try{UIUtils.showLoading("Loading rating data..."),appState.currentDisplayedPeriod=t,e.refreshDropdown(),domElements.reviewPeriodDisplay.textContent=`${DateUtils.formatDateStringCompact(t.startDate)} - ${DateUtils.formatDateStringCompact(t.endDate)}`,domElements.reviewPeriodDisplay.style.display="none";const a=await fetch(`${CONFIG.apiUrl}?action=getTARatings&taId=${appState.selectedTAId}`);if(!a.ok)throw new Error("Failed to fetch ratings");const n=await a.json(),r=n.ratings.map(e=>({...e,startDate:DateUtils.formatDateStringCompact(e.startDate),endDate:DateUtils.formatDateStringCompact(e.endDate)})).find(e=>e.raterType===appState.currentUserType&&e.startDate===t.startDate&&e.endDate===t.endDate);r?(e.displayExistingRating(r),domElements.ratingForm.style.display="none"):(domElements.reviewPeriodDisplay.textContent=`${DateUtils.formatDateStringCompact(t.startDate)} - ${DateUtils.formatDateStringCompact(t.endDate)} (No rating found)`,domElements.ratingForm.style.display="block",UIUtils.resetForm(domElements.ratingForm),e.setupRatingFieldListeners()),UIUtils.hideLoading()}catch(a){UIUtils.hideLoading(),domElements.reviewPeriodDisplay.textContent=`${DateUtils.formatDateStringCompact(t.startDate)} - ${DateUtils.formatDateStringCompact(t.endDate)} (Error loading)`,domElements.ratingForm.style.display="none"}}static displayExistingRating(e){const t=document.getElementById("existingRatingDisplay");t&&t.remove();const a=document.createElement("div");a.id="existingRatingDisplay";const n={name:e.raterName,type:e.raterType,date:DateUtils.formatDateCompact(new Date(e.timestamp))},r=UIUtils.createModernRatingDisplay(e,n,RATING_CATEGORIES,e.comments);a.appendChild(r),domElements.reviewPeriodDisplay.parentNode.insertBefore(a,domElements.reviewPeriodDisplay.nextSibling)}static clearValidationErrors(){document.querySelectorAll(".rating-group.error").forEach(e=>{e.classList.remove("error")}),document.querySelectorAll(".form-group.error").forEach(e=>{e.classList.remove("error")})}static setupRatingFieldListeners(){document.querySelectorAll('#ratingForm input[type="radio"]').forEach(e=>{e.addEventListener("change",function(){const e=this.closest(".rating-group");e&&e.classList.contains("error")&&e.classList.remove("error")})})}static async handleRatingSubmission(t){e.clearValidationErrors();const a={};let n=!1;if(["discipline","ethics","knowledge","communication","teamwork"].forEach(e=>{const r=t.get(e);if(r)a[e]=parseInt(r);else{n=!0;const t=document.querySelector(`input[name="${e}"]`).closest(".rating-group");t&&t.classList.add("error")}}),n){const e="Please rate all categories";UIUtils.showError(domElements.ratingError,e);const t=document.querySelector(".rating-group.error, .form-group.error");return t&&t.scrollIntoView({behavior:"smooth",block:"center"}),!1}const r={taId:appState.selectedTAId,taName:appState.selectedTAName,raterPhone:appState.currentUserPhone,raterName:appState.currentUserName,raterType:appState.currentUserType,startDate:appState.selectedStartDate,endDate:appState.selectedEndDate,...a,comments:t.get("comments")||"",timestamp:(new Date).toISOString()},i=await APIService.submitRating(r);return"success"===i.status?(ScreenManager.showConfirmationScreen(),!0):(UIUtils.showError(domElements.ratingError,i.message||"Failed to submit rating. Please try again."),!1)}},window.ScreenManager=class e{static showLogin(){domElements.hideAllContainers(),domElements.loginContainer.style.display="flex",UIUtils.resetForm(domElements.loginForm),domElements.resetErrors(),UIUtils.setCenteredBodyStyle()}static showTASelection(){domElements.hideAllContainers(),domElements.taSelectionContainer.style.display="flex",RatingManager.clearValidationErrors(),TAManager.cleanupDropdownListeners(),UIUtils.setCenteredBodyStyle(),0===appState.taList.length?APIService.fetchTAList().then(()=>{TAManager.populateTADropdown()}):TAManager.initializeCustomDropdown()}static showRatingScreenWithDateRange(){domElements.hideAllContainers(),domElements.ratingContainer.style.display="flex",RatingManager.clearValidationErrors();const e=document.getElementById("ratingControls");e&&e.remove(),OfficerRatingManager.resetSections();const t=document.getElementById("existingRatingDisplay");t&&t.remove();const a=document.querySelector("#ratingContainer .page-title");a&&(a.innerHTML='<i class="fas fa-plus-circle"></i>Add New Rating'),domElements.selectedTANameDisplay.textContent=appState.selectedTAName,domElements.reviewPeriodDisplay.textContent=`${DateUtils.formatDateStringCompact(appState.selectedStartDate)} - ${DateUtils.formatDateStringCompact(appState.selectedEndDate)}`,domElements.reviewPeriodDisplay.style.display="block",UIUtils.resetForm(domElements.ratingForm),domElements.ratingForm.style.display="block",RatingManager.setupRatingFieldListeners(),UIUtils.setScrollableBodyStyle()}static async showRatingScreenWithPreviousData(){domElements.hideAllContainers(),domElements.ratingContainer.style.display="flex",RatingManager.clearValidationErrors();const t=document.getElementById("existingRatingDisplay");t&&t.remove(),appState.clearDisplayedPeriod(),OfficerRatingManager.resetSections();const a=document.querySelector("#ratingContainer .page-title");a&&(a.innerHTML='<i class="fas fa-star"></i>Past TA Ratings'),domElements.selectedTANameDisplay.textContent=appState.selectedTAName,"officer"===appState.currentUserType?await OfficerRatingManager.initializeOfficerRatingScreen():await e.showRegularRatingScreen(),UIUtils.setScrollableBodyStyle()}static async showRegularRatingScreen(){await APIService.fetchExistingReviewPeriods(),RatingManager.createRatingControls(),appState.existingReviewPeriods.length>0?await RatingManager.displayRatingForPeriod(appState.existingReviewPeriods[0]):(domElements.reviewPeriodDisplay.textContent="No previous ratings found",domElements.reviewPeriodDisplay.style.display="block",domElements.ratingForm.style.display="none")}static async showReviewManagement(){domElements.hideAllContainers(),domElements.reviewManagementContainer.style.display="block",domElements.reviewManagementTAName.textContent=appState.selectedTAName,await APIService.fetchExistingReviewPeriods(),ReviewManager.displayExistingReviews(),UIUtils.setScrollableBodyStyle()}static showConfirmationScreen(){domElements.hideAllContainers(),domElements.confirmationContainer.style.display="block",UIUtils.setCenteredBodyStyle()}static showDateRangeModal(){const t=document.getElementById("dateRangeModal");t&&(t.style.display="block",setTimeout(()=>{t.addEventListener("click",function(a){a.target===t&&e.closeDateRangeModal()})},100)),DateUtils.setDateConstraints();const a=document.getElementById("startDate"),n=document.getElementById("endDate");a&&(a.value=""),n&&(n.value="");const r=document.getElementById("proceedWithDatesBtn");r&&(r.disabled=!0)}static closeDateRangeModal(){const e=document.getElementById("dateRangeModal");e&&(e.style.display="none");const t=document.getElementById("startDate"),a=document.getElementById("endDate"),n=document.getElementById("dateRangeError");t&&(t.value=""),a&&(a.value=""),n&&(n.style.display="none");const r=document.getElementById("proceedWithDatesBtn");r&&(r.disabled=!0)}}}}});
//# sourceMappingURL=managers-legacy-89r7YT5m.js.map
